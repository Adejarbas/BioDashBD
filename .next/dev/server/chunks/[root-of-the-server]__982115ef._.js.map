{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///app/app/api/stripe/checkout-session/route.ts"],"sourcesContent":["export const runtime = 'nodejs';\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport Stripe from 'stripe';\r\nimport { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs';\r\nimport { cookies } from 'next/headers';\r\n\r\nconst env = (typeof globalThis !== \"undefined\" && (globalThis as any).process && (globalThis as any).process.env)\r\n  ? (globalThis as any).process.env\r\n  : ({} as Record<string, string | undefined>);\r\n\r\n// Use as chaves do ambiente (não exponha chaves secretas no repositório).\r\nconst stripe = new Stripe(env.STRIPE_SECRET_KEY || env.SECRET_STRIPE_KEY || '');\r\n\r\nexport async function POST(req: NextRequest) {\r\n  if (!env.STRIPE_SECRET_KEY && !env.SECRET_STRIPE_KEY) {\r\n    return NextResponse.json({ error: 'Stripe não configurado' }, { status: 501 })\r\n  }\r\n  // Autenticação via Supabase usando cookies (App Router)\r\n  const supabase = createRouteHandlerClient({ cookies });\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser();\r\n  if (!user) {\r\n    return NextResponse.json({ error: 'Não autenticado' }, { status: 401 });\r\n  }\r\n\r\n  // (Opcional) Receber dados do produto via body\r\n  // const { productName, amount } = await req.json();\r\n\r\n  try {\r\n    const session = await stripe.checkout.sessions.create({\r\n      line_items: [\r\n        {\r\n          price_data: {\r\n            currency: 'BRL',\r\n            product_data: {\r\n              name: 'Valor pagamento', // Troque conforme necessário\r\n            },\r\n            unit_amount: 2000, // Troque conforme necessário\r\n          },\r\n          quantity: 1,\r\n        },\r\n      ],\r\n      mode: 'payment',\r\n      success_url: `${(env.FRONTEND_URL || 'http://localhost:3001')}/dashboard`,\r\n      cancel_url: `${env.FRONTEND_URL || 'http://localhost:3001'}`,\r\n      customer_email: user.email,\r\n    });\r\n    return NextResponse.json({ url: session.url });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;AACA;AACA;AACA;AACA;AAJO,MAAM,UAAU;;;;;AAMvB,MAAM,MAAM,AAAC,OAAO,eAAe,eAAe,AAAC,WAAmB,OAAO,IAAI,AAAC,WAAmB,OAAO,CAAC,GAAG,GAC5G,AAAC,WAAmB,OAAO,CAAC,GAAG,GAC9B,CAAC;AAEN,0EAA0E;AAC1E,MAAM,SAAS,IAAI,mKAAM,CAAC,IAAI,iBAAiB,IAAI,IAAI,iBAAiB,IAAI;AAErE,eAAe,KAAK,GAAgB;IACzC,IAAI,CAAC,IAAI,iBAAiB,IAAI,CAAC,IAAI,iBAAiB,EAAE;QACpD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAC9E;IACA,wDAAwD;IACxD,MAAM,WAAW,IAAA,sMAAwB,EAAC;QAAE,SAAA,4IAAO;IAAC;IACpD,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAC/B,IAAI,CAAC,MAAM;QACT,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAkB,GAAG;YAAE,QAAQ;QAAI;IACvE;IAEA,+CAA+C;IAC/C,oDAAoD;IAEpD,IAAI;QACF,MAAM,UAAU,MAAM,OAAO,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC;YACpD,YAAY;gBACV;oBACE,YAAY;wBACV,UAAU;wBACV,cAAc;4BACZ,MAAM;wBACR;wBACA,aAAa;oBACf;oBACA,UAAU;gBACZ;aACD;YACD,MAAM;YACN,aAAa,GAAI,IAAI,YAAY,IAAI,wBAAyB,UAAU,CAAC;YACzE,YAAY,GAAG,IAAI,YAAY,IAAI,yBAAyB;YAC5D,gBAAgB,KAAK,KAAK;QAC5B;QACA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,KAAK,QAAQ,GAAG;QAAC;IAC9C,EAAE,OAAO,OAAY;QACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF","debugId":null}}]
}