{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///app/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient, type CookieOptions } from '@supabase/ssr'\r\nimport { cookies } from 'next/headers'\r\n\r\nconst env = process.env\r\n\r\n// Check if Supabase environment variables are available\r\nexport const isSupabaseConfigured =\r\n  typeof env.NEXT_PUBLIC_SUPABASE_URL === \"string\" &&\r\n  env.NEXT_PUBLIC_SUPABASE_URL!.length > 0 &&\r\n  typeof env.NEXT_PUBLIC_SUPABASE_ANON_KEY === \"string\" &&\r\n  env.NEXT_PUBLIC_SUPABASE_ANON_KEY!.length > 0\r\n\r\nexport function createClient() {\r\n  if (!isSupabaseConfigured) {\r\n    throw new Error(\"Supabase is not configured. Please check your environment variables.\")\r\n  }\r\n\r\n  const cookieStore = cookies()\r\n\r\n  return createServerClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        async get(name: string) {\r\n          const store = await cookieStore\r\n          return store.get(name)?.value\r\n        },\r\n        async set(name: string, value: string, options: CookieOptions) {\r\n          try {\r\n            const store = await cookieStore\r\n            store.set({ name, value, ...options })\r\n          } catch (error) {\r\n            // The `set` method was called from a Server Component.\r\n            // This can be ignored if you have middleware refreshing\r\n            // user sessions.\r\n          }\r\n        },\r\n        async remove(name: string, options: CookieOptions) {\r\n          try {\r\n            const store = await cookieStore\r\n            store.set({ name, value: '', ...options })\r\n          } catch (error) {\r\n            // The `delete` method was called from a Server Component.\r\n            // This can be ignored if you have middleware refreshing\r\n            // user sessions.\r\n          }\r\n        },\r\n      },\r\n    }\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAEA,MAAM,MAAM,QAAQ,GAAG;AAGhB,MAAM,uBACX,wFAAwC,YACxC,6EAA8B,MAAM,GAAG,KACvC,gQAA6C,YAC7C,qPAAmC,MAAM,GAAG;AAEvC,SAAS;IACd,IAAI,CAAC,sBAAsB;QACzB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,cAAc,IAAA,4IAAO;IAE3B,OAAO,IAAA,iMAAkB,sUAGvB;QACE,SAAS;YACP,MAAM,KAAI,IAAY;gBACpB,MAAM,QAAQ,MAAM;gBACpB,OAAO,MAAM,GAAG,CAAC,OAAO;YAC1B;YACA,MAAM,KAAI,IAAY,EAAE,KAAa,EAAE,OAAsB;gBAC3D,IAAI;oBACF,MAAM,QAAQ,MAAM;oBACpB,MAAM,GAAG,CAAC;wBAAE;wBAAM;wBAAO,GAAG,OAAO;oBAAC;gBACtC,EAAE,OAAO,OAAO;gBACd,uDAAuD;gBACvD,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;YACA,MAAM,QAAO,IAAY,EAAE,OAAsB;gBAC/C,IAAI;oBACF,MAAM,QAAQ,MAAM;oBACpB,MAAM,GAAG,CAAC;wBAAE;wBAAM,OAAO;wBAAI,GAAG,OAAO;oBAAC;gBAC1C,EAAE,OAAO,OAAO;gBACd,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ","debugId":null}},
    {"offset": {"line": 141, "column": 0}, "map": {"version":3,"sources":["file:///app/app/api/user/route.ts"],"sourcesContent":["export const runtime = 'nodejs';\r\nimport { NextResponse } from \"next/server\"\r\nimport { createClient } from \"@/lib/supabase/server\"\r\n\r\nexport async function GET(request: Request) {\r\n  try {\r\n    const supabase = createClient()\r\n\r\n    // Get authenticated user\r\n    const {\r\n      data: { user },\r\n      error: authError,\r\n    } = await supabase.auth.getUser()\r\n    if (authError || !user) {\r\n      return NextResponse.json({ success: false, message: \"Unauthorized\" }, { status: 401 })\r\n    }\r\n\r\n    if (!(\"from\" in supabase)) {\r\n      return NextResponse.json({ success: false, message: \"Supabase client não configurado corretamente.\" }, { status: 500 });\r\n    }\r\n    const { data: userProfile, error } = await supabase.from(\"users\").select(\"*\").eq(\"id\", user.id).single();\r\n\r\n    if (error && error.code !== \"PGRST116\") {\r\n      // PGRST116 = no rows returned\r\n      console.error(\"Database error:\", error)\r\n      return NextResponse.json({ success: false, message: \"Failed to fetch user data\" }, { status: 500 })\r\n    }\r\n\r\n    // Return user data (create profile if doesn't exist)\r\n    const userData = userProfile || {\r\n      id: user.id,\r\n      email: user.email,\r\n      full_name: user.user_metadata?.full_name || \"User\",\r\n      company_name: null,\r\n      address: null,\r\n      phone: null,\r\n      profile_image_url: null,\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      user: userData,\r\n    })\r\n  } catch (error) {\r\n    console.error(\"Auth error:\", error)\r\n    return NextResponse.json({ success: false, message: \"Internal server error\" }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function PUT(request: Request) {\r\n  try {\r\n    const supabase = createClient()\r\n\r\n    // Get authenticated user\r\n    const {\r\n      data: { user },\r\n      error: authError,\r\n    } = await supabase.auth.getUser()\r\n    if (authError || !user) {\r\n      return NextResponse.json({ success: false, message: \"Unauthorized\" }, { status: 401 })\r\n    }\r\n\r\n    const body = await request.json()\r\n    const { full_name, company_name, address, phone, profile_image_url } = body\r\n\r\n    // Upsert user profile\r\n    if (!(\"from\" in supabase)) {\r\n      return NextResponse.json({ success: false, message: \"Supabase client não configurado corretamente.\" }, { status: 500 });\r\n    }\r\n    const { data, error } = await supabase\r\n      .from(\"users\")\r\n      .upsert({\r\n        id: user.id,\r\n        email: user.email,\r\n        full_name,\r\n        company_name,\r\n        address,\r\n        phone,\r\n        profile_image_url,\r\n        updated_at: new Date().toISOString(),\r\n      })\r\n      .select()\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error(\"Database error:\", error)\r\n      return NextResponse.json({ success: false, message: \"Failed to update user data\" }, { status: 500 })\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      user: data,\r\n      message: \"Profile updated successfully\",\r\n    })\r\n  } catch (error) {\r\n    console.error(\"Update error:\", error)\r\n    return NextResponse.json({ success: false, message: \"Internal server error\" }, { status: 500 })\r\n  }\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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","debugId":null}}]
}