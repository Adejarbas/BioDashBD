{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport type { NextRequest } from \"next/server\";\r\nimport { createServerClient } from \"@supabase/ssr\";\r\n\r\n// Remove barra final se existir na origem\r\nfunction normalizeOrigin(origin: string) {\r\n  return origin.endsWith(\"/\") ? origin.slice(0, -1) : origin;\r\n}\r\nconst FRONTEND_ORIGIN = normalizeOrigin(process.env.FRONTEND_URL || \"http://localhost:3001\");\r\n\r\nexport async function middleware(req: NextRequest) {\r\n  // Preflight CORS para /api\r\n\r\n  // CORS Preflight para /api\r\n  if (req.method === \"OPTIONS\" && req.nextUrl.pathname.startsWith(\"/api\")) {\r\n    const origin = req.headers.get(\"origin\") || FRONTEND_ORIGIN;\r\n    const normalizedOrigin = normalizeOrigin(origin);\r\n    const resPre = new NextResponse(null, { status: 204 });\r\n    resPre.headers.set(\"Access-Control-Allow-Origin\", normalizedOrigin);\r\n    resPre.headers.set(\"Access-Control-Allow-Methods\", \"GET,POST,PUT,DELETE,OPTIONS\");\r\n    resPre.headers.set(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization\");\r\n    resPre.headers.set(\"Access-Control-Allow-Credentials\", \"true\");\r\n    return resPre;\r\n  }\r\n\r\n  const res = NextResponse.next();\r\n\r\n  // CORS em rotas /api\r\n  if (req.nextUrl.pathname.startsWith(\"/api\")) {\r\n    const origin = req.headers.get(\"origin\") || FRONTEND_ORIGIN;\r\n    const normalizedOrigin = normalizeOrigin(origin);\r\n    res.headers.set(\"Access-Control-Allow-Origin\", normalizedOrigin);\r\n    res.headers.set(\"Access-Control-Allow-Credentials\", \"true\");\r\n  }\r\n\r\n  if (!process.env.NEXT_PUBLIC_SUPABASE_URL || !process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY) {\r\n    return res;\r\n  }\r\n\r\n  // Proteção /dashboard\r\n  if (req.nextUrl.pathname.startsWith(\"/dashboard\")) {\r\n    try {\r\n      const supabase = createServerClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n        {\r\n          cookies: {\r\n            getAll: () => req.cookies.getAll(),\r\n            setAll: (cookiesToSet) => {\r\n              cookiesToSet.forEach(({ name, value, options }) =>\r\n                res.cookies.set(name, value, { ...(options || {}), path: \"/\" })\r\n              );\r\n            },\r\n          },\r\n        }\r\n      );\r\n      const { data } = await supabase.auth.getUser();\r\n      if (!(data as any)?.user) {\r\n        const loginUrl = new URL(\"/login\", req.url);\r\n        loginUrl.searchParams.set(\"next\", req.nextUrl.pathname + (req.nextUrl.search || \"\"));\r\n        return NextResponse.redirect(loginUrl);\r\n      }\r\n    } catch {\r\n      // fail-open\r\n    }\r\n  }\r\n\r\n  return res;\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\"/dashboard/:path*\", \"/api/:path*\"],\r\n};"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;AAAA;;;AAEA,0CAA0C;AAC1C,SAAS,gBAAgB,MAAc;IACrC,OAAO,OAAO,QAAQ,CAAC,OAAO,OAAO,KAAK,CAAC,GAAG,CAAC,KAAK;AACtD;AACA,MAAM,kBAAkB,gBAAgB,QAAQ,GAAG,CAAC,YAAY,IAAI;AAE7D,eAAe,WAAW,GAAgB;IAC/C,2BAA2B;IAE3B,2BAA2B;IAC3B,IAAI,IAAI,MAAM,KAAK,aAAa,IAAI,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,SAAS;QACvE,MAAM,SAAS,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa;QAC5C,MAAM,mBAAmB,gBAAgB;QACzC,MAAM,SAAS,IAAI,gMAAY,CAAC,MAAM;YAAE,QAAQ;QAAI;QACpD,OAAO,OAAO,CAAC,GAAG,CAAC,+BAA+B;QAClD,OAAO,OAAO,CAAC,GAAG,CAAC,gCAAgC;QACnD,OAAO,OAAO,CAAC,GAAG,CAAC,gCAAgC;QACnD,OAAO,OAAO,CAAC,GAAG,CAAC,oCAAoC;QACvD,OAAO;IACT;IAEA,MAAM,MAAM,gMAAY,CAAC,IAAI;IAE7B,qBAAqB;IACrB,IAAI,IAAI,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,SAAS;QAC3C,MAAM,SAAS,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa;QAC5C,MAAM,mBAAmB,gBAAgB;QACzC,IAAI,OAAO,CAAC,GAAG,CAAC,+BAA+B;QAC/C,IAAI,OAAO,CAAC,GAAG,CAAC,oCAAoC;IACtD;IAEA;;IAIA,sBAAsB;IACtB,IAAI,IAAI,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,eAAe;QACjD,IAAI;YACF,MAAM,WAAW,IAAA,uMAAkB,sUAGjC;gBACE,SAAS;oBACP,QAAQ,IAAM,IAAI,OAAO,CAAC,MAAM;oBAChC,QAAQ,CAAC;wBACP,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,IAAI,OAAO,CAAC,GAAG,CAAC,MAAM,OAAO;gCAAE,GAAI,WAAW,CAAC,CAAC;gCAAG,MAAM;4BAAI;oBAEjE;gBACF;YACF;YAEF,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;YAC5C,IAAI,CAAE,MAAc,MAAM;gBACxB,MAAM,WAAW,IAAI,IAAI,UAAU,IAAI,GAAG;gBAC1C,SAAS,YAAY,CAAC,GAAG,CAAC,QAAQ,IAAI,OAAO,CAAC,QAAQ,GAAG,CAAC,IAAI,OAAO,CAAC,MAAM,IAAI,EAAE;gBAClF,OAAO,gMAAY,CAAC,QAAQ,CAAC;YAC/B;QACF,EAAE,OAAM;QACN,YAAY;QACd;IACF;IAEA,OAAO;AACT;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAqB;KAAc;AAC/C"}}]
}